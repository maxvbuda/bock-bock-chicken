<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Homework Kanban Board</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f7f6f2;
      color: #333;
    }
    .top-menu {
      width: 100%;
      background: #fffbe7;
      border-bottom: 2px solid #e6d1a3;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .top-menu ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      gap: 24px;
    }
    .top-menu li {
      display: inline;
    }
    .top-menu a {
      display: inline-block;
      padding: 12px 28px;
      font-size: 1.1em;
      color: #fff;
      background: #d97428;
      border: none;
      border-radius: 8px;
      font-family: 'Georgia', serif;
      font-weight: bold;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }
    .top-menu a:hover {
      background: #a85c1a;
      color: #ffe4b3;
      text-decoration: none;
      box-shadow: 0 4px 16px rgba(0,0,0,0.13);
    }
    .top-menu a.active {
      background: #fffbe7;
      color: #d97428;
      border: 2px solid #d97428;
      cursor: default;
      box-shadow: none;
      pointer-events: none;
    }
    .kanban-board {
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      gap: 2vw;
      margin: 24px auto 0 auto;
      max-width: 100vw;
      overflow-x: auto;
      padding: 0 2vw 24px 2vw;
      min-height: 70vh;
    }
    .kanban-column {
      background: #fffbe7;
      border: 2px solid #e6d1a3;
      border-radius: 16px;
      min-width: 280px;
      max-width: 320px;
      flex-shrink: 0;
      box-shadow: 0 4px 16px rgba(0,0,0,0.07);
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 12px;
    }
    .kanban-column-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 8px;
    }
    .kanban-column-header h2 {
      text-align: center;
      color: #d97428;
      font-family: 'Georgia', serif;
      font-size: 1.3em;
      margin: 0;
      flex-grow: 1;
      cursor: pointer;
    }
    .kanban-column-header h2:focus {
        outline: 1px solid #d97428;
        border-radius: 4px;
    }
    .delete-column-btn {
        background: none;
        border: none;
        color: #a00;
        font-size: 1.2em;
        cursor: pointer;
        padding: 4px;
    }
    .kanban-tasks {
      flex: 1;
      min-height: 60px;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .kanban-task {
      background: url('images/egg.png') no-repeat center/cover;
      border-radius: 50% / 80%;
      padding: 48px 24px 56px 24px;
      font-size: 1em;
      color: #7a4a13;
      cursor: grab;
      border: none;
      user-select: none;
      position: relative;
      min-height: 180px;
      min-width: 120px;
      max-width: 320px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-weight: bold;
      position: relative;
      overflow: hidden;
    }
    .kanban-task:not(:first-child) {
      margin-top: -4.2cm;
    }
    .kanban-task.dragging {
      opacity: 0.5;
    }
    .delete-task-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: #ffe4b3;
        color: #a00;
        border: none;
        font-size: 1.1em;
        border-radius: 4px;
        cursor: pointer;
        padding: 2px 8px;
        z-index: 3;
        box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .kanban-add-task {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      width: 100%;
    }
    .kanban-add-task input {
      flex: 1 1 0;
      padding: 5px 6px;
      border-radius: 5px;
      border: 1px solid #e6d1a3;
      font-size: 0.95em;
      outline: none;
      min-width: 0;
      box-sizing: border-box;
    }
    .kanban-add-task button {
      background: #d97428;
      color: #fffbe7;
      border: none;
      border-radius: 5px;
      font-size: 0.95em;
      padding: 5px 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .kanban-add-task button:hover {
      background: #a85c1a;
    }
  </style>
</head>
<body>
  <nav class="top-menu">
    <ul>
      <li><a href="index.html">The Cluckington Family</a></li>
      <li><a href="family-members.html">Family Members</a></li>
      <li><a href="golden-knight.html">The Golden Knight of Chickenopolis</a></li>
      <li><a href="homework.html" class="active">Homework Kanban</a></li>
      <li><a href="games.html">Games</a></li>
    </ul>
  </nav>
  <div id="add-column-container" style="text-align: center; padding: 20px 0; background: #f7f6f2;">
    <button id="add-column-btn" style="background: #5a9a5a; color: #fff; border: none; border-radius: 8px; font-size: 1.1em; padding: 10px 20px; cursor: pointer; transition: background 0.2s;">+ Add Column</button>
    <div id="add-column-form" style="display: none; gap: 8px; justify-content: center;">
      <input type="text" id="new-column-title" placeholder="Enter column name..." style="padding: 8px 12px; border-radius: 5px; border: 1px solid #e6d1a3; font-size: 1em;">
      <button id="save-column-btn" style="background: #5a9a5a; color: #fff; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer;">Save</button>
      <button id="cancel-add-column-btn" style="background: #d97428; color: #fff; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer;">Cancel</button>
    </div>
  </div>
  <div class="kanban-board" id="kanban-board">
    <!-- Columns will be dynamically inserted here -->
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const kanbanBoard = document.getElementById('kanban-board');
      let kanbanData = [];

      function saveKanban() {
        localStorage.setItem('kanban_homework_dynamic', JSON.stringify(kanbanData));
      }

      function loadKanban() {
        const data = localStorage.getItem('kanban_homework_dynamic');
        if (data) {
          kanbanData = JSON.parse(data);
        } else {
          // Check for old data and migrate if it exists
          const oldData = localStorage.getItem('kanban_homework');
          if (oldData) {
            migrateOldData(JSON.parse(oldData));
          } else {
            initializeDefaultKanban();
          }
        }
      }

      function migrateOldData(oldData) {
        kanbanData = [
          { title: "To Do", tasks: oldData.todo || [] },
          { title: "In Progress", tasks: oldData.inprogress || [] },
          { title: "Done", tasks: oldData.done || [] }
        ];
        saveKanban();
        localStorage.removeItem('kanban_homework');
      }

      function initializeDefaultKanban() {
        kanbanData = [
          { title: "To Do", tasks: ["Read a chapter", "Math exercises"] },
          { title: "In Progress", tasks: ["History essay"] },
          { title: "Done", tasks: ["Science project"] }
        ];
      }

      function renderKanban() {
        kanbanBoard.innerHTML = '';
        kanbanData.forEach((column, columnIndex) => {
          const columnDiv = document.createElement('div');
          columnDiv.className = 'kanban-column';
          columnDiv.dataset.columnIndex = columnIndex;

          const headerDiv = document.createElement('div');
          headerDiv.className = 'kanban-column-header';

          const h2 = document.createElement('h2');
          h2.textContent = column.title;
          h2.contentEditable = true;
          h2.addEventListener('blur', () => {
            kanbanData[columnIndex].title = h2.textContent;
            saveKanban();
          });
          h2.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              e.preventDefault();
              h2.blur();
            }
          });

          const deleteColBtn = document.createElement('button');
          deleteColBtn.textContent = '✖';
          deleteColBtn.title = 'Delete Column';
          deleteColBtn.className = 'delete-column-btn';
          deleteColBtn.onclick = () => deleteColumn(columnIndex);

          headerDiv.appendChild(h2);
          headerDiv.appendChild(deleteColBtn);

          const tasksDiv = document.createElement('div');
          tasksDiv.className = 'kanban-tasks';
          tasksDiv.dataset.columnIndex = columnIndex;

          column.tasks.forEach((taskText, taskIndex) => {
            tasksDiv.appendChild(createTaskElement(taskText, columnIndex, taskIndex));
          });

          const addTaskDiv = document.createElement('div');
          addTaskDiv.className = 'kanban-add-task';
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = 'Add new task...';
          const button = document.createElement('button');
          button.textContent = 'Add';
          button.onclick = () => addTask(columnIndex, input.value);
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              addTask(columnIndex, input.value);
            }
          });

          addTaskDiv.appendChild(input);
          addTaskDiv.appendChild(button);

          columnDiv.appendChild(headerDiv);
          columnDiv.appendChild(tasksDiv);
          columnDiv.appendChild(addTaskDiv);
          kanbanBoard.appendChild(columnDiv);
        });
        addDragAndDropListeners();
      }

      function createTaskElement(taskText, columnIndex, taskIndex) {
        const div = document.createElement('div');
        div.className = 'kanban-task';
        div.draggable = true;
        div.dataset.columnIndex = columnIndex;
        div.dataset.taskIndex = taskIndex;

        const textWrap = document.createElement('div');
        textWrap.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; height: 60%; display: flex; align-items: center; justify-content: center; text-align: center; pointer-events: none;';
        
        const span = document.createElement('span');
        span.textContent = taskText;
        span.style.cssText = 'display: inline-block; word-break: break-word; font-size: 1em; color: #7a4a13; font-weight: bold;';
        textWrap.appendChild(span);

        const delBtn = document.createElement('button');
        delBtn.textContent = '✖';
        delBtn.title = 'Delete Task';
        delBtn.className = 'delete-task-btn';
        delBtn.onclick = (e) => {
          e.stopPropagation();
          deleteTask(columnIndex, taskIndex);
        };

        div.appendChild(textWrap);
        div.appendChild(delBtn);
        return div;
      }

      function addColumn(title) {
        if (!title) return;
        kanbanData.push({ title: title, tasks: [] });
        saveKanban();
        renderKanban();
      }

      function deleteColumn(columnIndex) {
        if (confirm('Are you sure you want to delete this column and all its tasks?')) {
          kanbanData.splice(columnIndex, 1);
          saveKanban();
          renderKanban();
        }
      }

      function addTask(columnIndex, taskText) {
        const text = taskText.trim();
        if (!text) return;
        kanbanData[columnIndex].tasks.push(text);
        saveKanban();
        renderKanban();
      }

      function deleteTask(columnIndex, taskIndex) {
        kanbanData[columnIndex].tasks.splice(taskIndex, 1);
        saveKanban();
        renderKanban();
      }

      // Drag and drop logic
      let dragSrc = null;
      function onDragStart(e) {
        e.target.classList.add('dragging');
        dragSrc = {
          columnIndex: e.target.dataset.columnIndex,
          taskIndex: e.target.dataset.taskIndex
        };
      }

      function onDrop(e) {
        e.preventDefault();
        if (!dragSrc) return;
        const dropTarget = e.target.closest('.kanban-tasks');
        if (!dropTarget) return;

        const toColumnIndex = dropTarget.dataset.columnIndex;
        const task = kanbanData[dragSrc.columnIndex].tasks[dragSrc.taskIndex];

        // Remove from old position
        kanbanData[dragSrc.columnIndex].tasks.splice(dragSrc.taskIndex, 1);
        // Add to new position
        kanbanData[toColumnIndex].tasks.push(task);

        saveKanban();
        renderKanban();
        dragSrc = null;
      }

      function addDragAndDropListeners() {
        document.querySelectorAll('.kanban-task').forEach(task => {
          task.addEventListener('dragstart', onDragStart);
          task.addEventListener('dragend', (e) => e.target.classList.remove('dragging'));
        });
        document.querySelectorAll('.kanban-tasks').forEach(col => {
          col.addEventListener('dragover', (e) => e.preventDefault());
          col.addEventListener('drop', onDrop);
        });
      }

      // Add column form logic
      const addColumnBtn = document.getElementById('add-column-btn');
      const addColumnForm = document.getElementById('add-column-form');
      const newColumnTitleInput = document.getElementById('new-column-title');
      const saveColumnBtn = document.getElementById('save-column-btn');
      const cancelAddColumnBtn = document.getElementById('cancel-add-column-btn');

      addColumnBtn.addEventListener('click', () => {
        addColumnBtn.style.display = 'none';
        addColumnForm.style.display = 'flex';
        newColumnTitleInput.focus();
      });

      function hideAddColumnForm() {
        addColumnForm.style.display = 'none';
        addColumnBtn.style.display = 'inline-block';
        newColumnTitleInput.value = '';
      }

      saveColumnBtn.addEventListener('click', () => {
        addColumn(newColumnTitleInput.value);
        hideAddColumnForm();
      });

      cancelAddColumnBtn.addEventListener('click', hideAddColumnForm);

      newColumnTitleInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          saveColumnBtn.click();
        } else if (e.key === 'Escape') {
          cancelAddColumnBtn.click();
        }
      });

      // Initial load
      loadKanban();
      renderKanban();
    });
  </script>
</body>
</html>